<?xml version="1.0" encoding="utf-8"?>
<!--

  Technical Committee:
  OASIS Open Data Protocol (OData) TC
  https://www.oasis-open.org/committees/odata

  Chairs:
  - Ralf Handl (ralf.handl@sap.com), SAP SE
  - Michael Pizzo (mikep@microsoft.com), Microsoft

  Editors:
  - Ralf Handl (ralf.handl@sap.com), SAP SE
  - Michael Pizzo (mikep@microsoft.com), Microsoft

  Additional artifacts:
  This vocabulary is one component of a Work Product that also includes the following vocabulary components:
  - OData Core Vocabulary. Latest version: https://oasis-tcs.github.io/odata-vocabularies/vocabularies/Org.OData.Core.V1.xml.
  - OData Measures Vocabulary. Latest version: https://oasis-tcs.github.io/odata-vocabularies/vocabularies/Org.OData.Measures.V1.xml.
  - OData Capabilities Vocabulary. Latest version: https://oasis-tcs.github.io/odata-vocabularies/vocabularies/Org.OData.Capabilities.V1.xml.
  - OData Validation Vocabulary. Latest version: https://oasis-tcs.github.io/odata-vocabularies/vocabularies/Org.OData.Validation.V1.xml.
  - OData Aggregation Vocabulary. Latest version: https://oasis-tcs.github.io/odata-vocabularies/vocabularies/Org.OData.Aggregation.V1.xml.
  - OData Authorization Vocabulary. Latest version: https://oasis-tcs.github.io/odata-vocabularies/vocabularies/Org.OData.Authorization.V1.xml.

  Related work:
  This vocabulary replaces or supersedes:
  - None.
  This vocabulary is related to:
  - OData Version 4.01 Part 1: Protocol. Latest version: http://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part1-protocol.html.
  - OData Version 4.01 Part 2: URL Conventions. Latest version: http://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part2-url-conventions.html.
  - OData Common Schema Definition Language (CSDL) JSON Representation Version 4.01. Latest version: http://docs.oasis-open.org/odata/odata-csdl-json/v4.01/odata-csdl-json-v4.01.html.
  - OData Common Schema Definition Language (CSDL) XML Representation Version 4.01. Latest version: http://docs.oasis-open.org/odata/odata-csdl-xml/v4.01/odata-csdl-xml-v4.01.html.
  - OData JSON Format Version 4.01. Latest version: http://docs.oasis-open.org/odata/odata-json-format/v4.01/odata-json-format-v4.01.html.
  - OData Extension for Data Aggregation Version 4.0. Latest version: http://docs.oasis-open.org/odata/odata-data-aggregation-ext/v4.0/odata-data-aggregation-ext-v4.0.html.

  Abstract:
  This vocabulary defines terms to describe which data in a given entity model is time-dependent, and how.

-->
<edmx:Edmx xmlns:edmx="http://docs.oasis-open.org/odata/ns/edmx" Version="4.0">
  <edmx:Reference Uri="https://oasis-tcs.github.io/odata-vocabularies/vocabularies/Org.OData.Core.V1.xml">
    <edmx:Include Namespace="Org.OData.Core.V1" Alias="Core" />
  </edmx:Reference>
  <edmx:DataServices>
    <Schema xmlns="http://docs.oasis-open.org/odata/ns/edm" Namespace="Org.OData.Temporal.V1" Alias="Temporal">
      <Annotation Term="Core.Description">
        <String>Terms for describing time-dependent data</String>
      </Annotation>
      <Annotation Term="Core.LongDescription">
        <String>*This is a working draft that may incompatibly change any time.*</String>
      </Annotation>
      <Annotation Term="Core.Links">
        <Collection>
          <Record>
            <PropertyValue Property="rel" String="latest-version" />
            <PropertyValue Property="href" String="https://oasis-tcs.github.io/odata-vocabularies/vocabularies/Org.OData.Temporal.V1.xml" />
          </Record>
          <Record>
            <PropertyValue Property="rel" String="alternate" />
            <PropertyValue Property="href" String="https://oasis-tcs.github.io/odata-vocabularies/vocabularies/Org.OData.Temporal.V1.json" />
          </Record>
          <Record>
            <PropertyValue Property="rel" String="describedby" />
            <PropertyValue Property="href" String="https://github.com/oasis-tcs/odata-vocabularies/blob/master/vocabularies/Org.OData.Temporal.V1.md" />
          </Record>
        </Collection>
      </Annotation>


      <Term Name="ApplicationTimeSupport" Type="Temporal.ApplicationTimeSupportType" Nullable="false" AppliesTo="Collection">
        <Annotation Term="Core.AppliesViaContainer" />
        <Annotation Term="Core.Description">
          <String>This collection supports temporal requests</String>
        </Annotation>
      </Term>

      <ComplexType Name="ApplicationTimeSupportType">
        <Property Name="DataHistory" Type="Temporal.DataHistory" Nullable="false">
          <Annotation Term="Core.Description" String="Describes how the data history is represented" />
        </Property>
        <Property Name="UnitOfTime" Type="Temporal.UnitOfTime" Nullable="false">
          <Annotation Term="Core.Description" String="Unit of time and other properties of a time period" />
        </Property>
      </ComplexType>

      <ComplexType Name="DataHistory" Abstract="true">
        <Annotation Term="Core.Description" String="Describes how the data history is represented" />
      </ComplexType>

      <ComplexType Name="DataHistorySnapshot" BaseType="Temporal.DataHistory">
        <Annotation Term="Core.Description" String="Each OData entity represents a snapshot of data at a point in application time that is the same for all entities in the collection" />
        <Annotation Term="Core.LongDescription">
          <String>The point in application time is defined by the `$at` clause of a request; default is the current point in time.</String>
        </Annotation>
      </ComplexType>

      <ComplexType Name="DataHistoryVisible" BaseType="Temporal.DataHistory">
        <Annotation Term="Core.Description" String="Each OData entity represents data during a period of application time; it is called a *time slice*" />
        <Annotation Term="Core.LongDescription">
          <String>A temporal collection of this kind MUST NOT contain two entities with the same
          `ObjectKey` whose application-time periods defined by their `TimeSliceStart` and `TimeSliceEnd` properties overlap;
          and it always contains all entities (with consecutive time periods) for a given object key.
          A collection MUST be of this kind if an action defined in this vocabulary is invoked on it.</String>
        </Annotation>
        <Property Name="TimeSliceStart" Type="Edm.PropertyPath" Nullable="false">
          <Annotation Term="Core.Description" String="Property containing lower boundary of a time slice" />
        </Property>
        <Property Name="TimeSliceEnd" Type="Edm.PropertyPath" Nullable="false">
          <Annotation Term="Core.Description" String="Property containing upper boundary of a time slice" />
        </Property>
        <Property Name="ObjectKey" Type="Collection(Edm.PropertyPath)" Nullable="false">
          <Annotation Term="Core.Description" String="The set of primitive properties that identify a temporal object" />
          <Annotation Term="Core.LongDescription" String="A temporal object is a set of facts whose changes over application time are tracked by the service. The entities in the annotated collection belong to potentially multiple temporal objects, and each temporal object is uniquely identified by the values of the specified object key properties. Object key properties follow the same rules as entity key properties. If no object key is specified, only a single temporal object belongs to the annotated collection." />
        </Property>
        <Property Name="SupportedActions" Type="Collection(Temporal.QualifiedActionName)" Nullable="false">
          <Annotation Term="Core.Description" String="List of supported temporal actions" />
        </Property>
      </ComplexType>

      <ComplexType Name="UnitOfTime" Abstract="true">
        <Annotation Term="Core.Description" String="Unit of time and other properties of a time period" />
      </ComplexType>

      <ComplexType Name="UnitOfTimeDateTimeOffset" BaseType="Temporal.UnitOfTime">
        <Annotation Term="Core.Description" String="Period start and end are of type Edm.DateTimeOffset" />
        <Property Name="Precision" Type="Edm.Byte" Nullable="false">
          <Annotation Term="Core.Description" String="Precision of Edm.DateTimeOffset values for period start and end" />
        </Property>
      </ComplexType>

      <ComplexType Name="UnitOfTimeDate" BaseType="Temporal.UnitOfTime">
        <Annotation Term="Core.Description" String="Period start and end are of type Edm.Date" />
        <Annotation Term="Core.LongDescription" String="The period is a contiguous set of days and does not consider the time of the day." />
        <Property Name="ClosedClosedPeriods" Type="Edm.Boolean" Nullable="false" DefaultValue="false">
          <Annotation Term="Core.Description" String="If `true`, the period end is the last day in the period; if `false`, the period end is the first day after the period" />
        </Property>
      </ComplexType>

      <!-- TODO: move this to Core, where we already have QualifiedTypeName and QualifiedTermName? -->
      <TypeDefinition Name="QualifiedActionName" UnderlyingType="Edm.String">
        <Annotation Term="Core.Description" String="The qualified name of an action in scope." />
      </TypeDefinition>


      <!-- TODO: move to separate TemporalActions vocabulary? -->
      <!-- Operations on Temporal Objects -->

      <Action Name="Update" IsBound="true" EntitySetPath="timeslices">
        <Annotation Term="Core.Description" String="Updates existing time slices with values from new time slices whose [`ApplicationTimeSupport/ObjectKey`](#ApplicationTimeSupportType)s match and whose intervals overlap" />
        <Annotation Term="Core.LongDescription">
          <String>The update behavior for a given object key is known from the [SQL statement](https://www.ibm.com/docs/en/db2oc?topic=statements-update)
          `UPDATE ... FOR PORTION OF BUSINESS_TIME ... WHERE ...`.</String>
        </Annotation>
        <Parameter Name="timeslices" Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Time slices to modify" />
        </Parameter>
        <Parameter Name="newTimeslices" Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="New time slices whose property values are used to update the `timeslices` collection" />
          <Annotation Term="Core.LongDescription">
            <String>Same entity type as binding parameter.
            The new time slices need not contain all properties, but at least the boundary values of the interval to change.
            An absent object key property matches any key property value.
            New time slices are processed in the order of the collection, which especially matters if some of the specified change intervals overlap.</String>
          </Annotation>
        </Parameter>
        <ReturnType Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Modified time slices" />
          <Annotation Term="Core.LongDescription" String="Same entity type as binding parameter." />
        </ReturnType>
      </Action>

      <Action Name="Upsert" IsBound="true" EntitySetPath="timeslices">
        <Annotation Term="Core.Description" String="Upserts a temporal object in a given period of application time after splitting partially overlapping time slices by updating existing time slices in that period and creating new time slices to close gaps in that period" />
        <Parameter Name="timeslices" Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Time slices to modify" />
        </Parameter>
        <Parameter Name="From" Type="Edm.PrimitiveType" Nullable="false">
          <Annotation Term="Core.Description" String="Lower boundary (inclusive) of application time. Date or DateTimeOffset value, or string with value `min`" />
        </Parameter>
        <Parameter Name="To" Type="Edm.PrimitiveType" Nullable="false">
          <Annotation Term="Core.Description" String="Upper boundary (exclusive) of application time. Date or DateTimeOffset value, or string with value `max`" />
        </Parameter>
        <Parameter Name="Values" Type="Edm.EntityType" Nullable="false">
          <Annotation Term="Core.Description" String="Property values to insert or update" />
          <Annotation Term="Core.LongDescription" String="Same entity type as binding parameter and return type, specify only values of non-key properties." />
        </Parameter>
        <Parameter Name="ObjectKey" Type="Edm.EntityType" Nullable="false">
          <Annotation Term="Core.OptionalParameter">
            <Record />
          </Annotation>
          <Annotation Term="Core.Description" String="Property values that identify a single temporal object" />
          <Annotation Term="Core.LongDescription" String="Select-expand projection of the same entity type as binding parameter, containing all and only properties reference in the [`ObjectKey`](#ObjectKey) of that entity type." />
        </Parameter>
        <ReturnType Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Modified time slices" />
          <Annotation Term="Core.LongDescription" String="Same entity type as binding parameter." />
        </ReturnType>
      </Action>

      <Action Name="UpdateFrom" IsBound="true" EntitySetPath="timeslices">
        <Annotation Term="Core.Description" String="Updates properties of time slices of a temporal object from a given point in time onwards and stops updating a property if its original value changes from one time slice to the next" />
        <Parameter Name="timeslices" Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Time slices to modify" />
        </Parameter>
        <Parameter Name="From" Type="Edm.PrimitiveType" Nullable="false">
          <Annotation Term="Core.Description" String="Lower boundary (inclusive) of application time. Date or DateTimeOffset value, or string with value `min`" />
        </Parameter>
        <Parameter Name="To" Type="Edm.PrimitiveType" Nullable="true">
          <Annotation Term="Core.Description" String="Optional upper boundary (exclusive) of application time. Date or DateTimeOffset value, or string with value `max`" />
        </Parameter>
        <Parameter Name="Values" Type="Edm.EntityType" Nullable="false">
          <Annotation Term="Core.Description" String="Property values to update" />
          <Annotation Term="Core.LongDescription" String="Same entity type as binding parameter and return type, specify only values of non-key properties." />
        </Parameter>
        <Parameter Name="ObjectKey" Type="Edm.EntityType" Nullable="false">
          <Annotation Term="Core.OptionalParameter">
            <Record />
          </Annotation>
          <Annotation Term="Core.Description" String="Property values that identify a single temporal object" />
          <Annotation Term="Core.LongDescription" String="Select-expand projection of the same entity type as binding parameter, containing all and only properties reference in the [`ObjectKey`](#ObjectKey) of that entity type." />
        </Parameter>
        <ReturnType Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Modified time slices" />
          <Annotation Term="Core.LongDescription" String="Same entity type as binding parameter." />
        </ReturnType>
      </Action>

      <Action Name="Synchronize" IsBound="true" EntitySetPath="timeslices">
        <Annotation Term="Core.Description" String="Synchronizes time slices of a temporal object to match the provided full application timeline" />
        <Parameter Name="timeslices" Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Time slices to modify" />
        </Parameter>
        <Parameter Name="Timeline" Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="List of time slices covering the full timeline of the temporal object" />
          <Annotation Term="Core.LongDescription" String="Same entity type as the binding parameter." />
        </Parameter>
        <Parameter Name="ObjectKey" Type="Edm.EntityType" Nullable="false">
          <Annotation Term="Core.OptionalParameter">
            <Record />
          </Annotation>
          <Annotation Term="Core.Description" String="Property values that identify a single temporal object" />
          <Annotation Term="Core.LongDescription" String="Select-expand projection of the same entity type as binding parameter, containing all and only properties reference in the [`ObjectKey`](#ObjectKey) of that entity type." />
        </Parameter>
      </Action>

      <Action Name="Delete" IsBound="true" EntitySetPath="timeslices">
        <Annotation Term="Core.Description" String="Deletes all time slices of a temporal object in a given period of application time after splitting partially overlapping time slices" />
        <Parameter Name="timeslices" Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Time slices to modify" />
        </Parameter>
        <Parameter Name="From" Type="Edm.PrimitiveType" Nullable="false">
          <Annotation Term="Core.Description" String="Lower boundary (inclusive) of application time. Date or DateTimeOffset value, or string with value `min`" />
        </Parameter>
        <Parameter Name="To" Type="Edm.PrimitiveType" Nullable="false">
          <Annotation Term="Core.Description" String="Upper boundary (exclusive) of application time. Date or DateTimeOffset value, or string with value `max`" />
        </Parameter>
        <Parameter Name="ObjectKey" Type="Edm.EntityType" Nullable="false">
          <Annotation Term="Core.OptionalParameter">
            <Record />
          </Annotation>
          <Annotation Term="Core.Description" String="Property values that identify a single temporal object" />
          <Annotation Term="Core.LongDescription" String="Select-expand projection of the same entity type as binding parameter, containing all and only properties reference in the [`ObjectKey`](#ObjectKey) of that entity type." />
        </Parameter>
        <ReturnType Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Deleted time slices" />
          <Annotation Term="Core.LongDescription" String="Same entity type as binding parameter." />
        </ReturnType>
      </Action>

      <Action Name="DeleteFrom" IsBound="true" EntitySetPath="timeslices">
        <Annotation Term="Core.Description" String="Deletes  time slices of a temporal object from a a given point in application time onwards and stops if a property changes its value from one time slice to the next" />
        <Parameter Name="timeslices" Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Time slices to modify" />
        </Parameter>
        <Parameter Name="From" Type="Edm.PrimitiveType" Nullable="false">
          <Annotation Term="Core.Description" String="Lower boundary (inclusive) of application time. Date or DateTimeOffset value, or string with value `min`" />
        </Parameter>
        <Parameter Name="To" Type="Edm.PrimitiveType" Nullable="true">
          <Annotation Term="Core.Description" String="Optional upper boundary (exclusive) of application time. Date or DateTimeOffset value, or string with value `max`" />
        </Parameter>
        <Parameter Name="ObjectKey" Type="Edm.EntityType" Nullable="false">
          <Annotation Term="Core.OptionalParameter">
            <Record />
          </Annotation>
          <Annotation Term="Core.Description" String="Property values that identify a single temporal object" />
          <Annotation Term="Core.LongDescription" String="Select-expand projection of the same entity type as binding parameter, containing all and only properties reference in the [`ObjectKey`](#ObjectKey) of that entity type." />
        </Parameter>
        <ReturnType Type="Collection(Edm.EntityType)" Nullable="false">
          <Annotation Term="Core.Description" String="Deleted time slices" />
          <Annotation Term="Core.LongDescription" String="Same entity type as binding parameter." />
        </ReturnType>
      </Action>

    </Schema>
  </edmx:DataServices>
</edmx:Edmx>
